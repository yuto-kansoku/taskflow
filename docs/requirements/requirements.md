# タスク管理アプリ - 要件定義書

**プロジェクト名**: TaskFlow
**バージョン**: 1.0.0
**作成日**: 2026-02-13
**最終更新**: 2026-02-13

---

## 📋 プロジェクト概要

個人・チーム向けのタスク管理アプリケーション。シンプルで直感的なUIを提供し、タスクの作成・管理・締め切り通知を実現します。

### ビジョン

- タスク管理を**シンプルに**
- 締め切りを**見逃さない**
- チーム協働を**スムーズに**

---

## 🎯 機能要件

### FR-001: ユーザー認証

**優先度**: P0-Critical
**説明**: ユーザーはCustomer Cloud認証基盤（CC-Auth）を使用してログインできる

**機能詳細**:
- CC-Auth統合によるシングルサインオン（SSO）
- OAuth 2.0 / OIDC準拠
- セッション管理（アクセストークン/リフレッシュトークン）
- ログアウト機能

**受入基準**:
- [x] CC-Auth認証フローが正常に動作する
- [x] 認証成功時にダッシュボードへリダイレクト
- [x] 認証失敗時に適切なエラーメッセージ表示
- [x] トークンリフレッシュが自動で行われる
- [x] ログアウト後にセッションが完全にクリアされる

**技術実装**:
- `@customer-cloud/platform-sdk` の認証モジュール使用
- Next.js Middleware でルートガード
- Cookie ベースのセッション管理

---

### FR-002: タスク作成

**優先度**: P0-Critical
**説明**: ユーザーは新しいタスクを作成できる

**機能詳細**:
- タスクタイトル（必須、最大200文字）
- タスク詳細（任意、Markdown対応）
- 締め切り日時（任意）
- 優先度（High/Medium/Low）
- カテゴリ/タグ（複数選択可）
- 担当者（自分 or チームメンバー）

**受入基準**:
- [x] タイトルを入力してタスクを作成できる
- [x] 締め切り日時をカレンダーから選択できる
- [x] 優先度を選択できる
- [x] タグを追加できる
- [x] バリデーションエラーが適切に表示される

**UI/UX要件**:
- モーダルまたはスライドオーバーで作成フォーム表示
- リアルタイムバリデーション
- 作成完了時にトースト通知

---

### FR-003: タスク一覧表示

**優先度**: P0-Critical
**説明**: ユーザーは自分のタスク一覧を表示できる

**機能詳細**:
- すべてのタスク表示
- フィルタリング（ステータス、優先度、期限、担当者）
- ソート（作成日、更新日、締め切り、優先度）
- 検索（タイトル・詳細・タグ）
- ページネーション（無限スクロール）

**受入基準**:
- [x] タスク一覧が表示される
- [x] フィルタを適用できる
- [x] ソート順を変更できる
- [x] 検索結果がリアルタイムで反映される
- [x] パフォーマンスが良好（1000件まで）

**UI/UX要件**:
- カードビュー / リストビュー切り替え
- ドラッグ&ドロップでステータス変更
- キーボードショートカット対応

---

### FR-004: タスク詳細表示・編集

**優先度**: P1-High
**説明**: ユーザーはタスクの詳細を表示・編集できる

**機能詳細**:
- タスク情報の表示
- インライン編集
- コメント機能
- 変更履歴表示

**受入基準**:
- [x] タスクをクリックして詳細を表示できる
- [x] 各項目を編集できる
- [x] 変更が即座に保存される（オートセーブ）
- [x] コメントを追加できる
- [x] 変更履歴を確認できる

---

### FR-005: タスク削除

**優先度**: P1-High
**説明**: ユーザーはタスクを削除できる

**機能詳細**:
- 論理削除（ソフトデリート）
- 削除確認ダイアログ
- 削除取り消し（30日間）

**受入基準**:
- [x] タスクを削除できる
- [x] 削除前に確認ダイアログが表示される
- [x] 削除したタスクはアーカイブされる
- [x] 30日以内であれば復元できる

---

### FR-006: 締め切り通知

**優先度**: P0-Critical
**説明**: タスクの締め切りが近づいたらユーザーに通知する

**機能詳細**:
- プッシュ通知（ブラウザ通知）
- メール通知（オプション）
- 通知タイミング設定
  - 締め切り当日 09:00
  - 締め切り1日前 09:00
  - 締め切り1週間前 09:00
- 通知設定のカスタマイズ

**受入基準**:
- [x] 締め切り当日に通知が届く
- [x] 締め切り1日前に通知が届く
- [x] 通知をクリックするとタスク詳細へ遷移
- [x] 通知設定をON/OFF切り替えられる
- [x] 通知時刻をカスタマイズできる

**技術実装**:
- Amazon EventBridge Scheduler（cron式）
- Amazon SNS（プッシュ通知配信）
- Web Push API（ブラウザ通知）

---

### FR-007: ダッシュボード

**優先度**: P1-High
**説明**: タスクの概要を一目で把握できるダッシュボードを提供する

**機能詳細**:
- 今日のタスク数
- 今週のタスク数
- 完了率グラフ
- 優先度別の分布
- 締め切り間近のタスク（次の5件）

**受入基準**:
- [x] ダッシュボードが表示される
- [x] 統計情報が正確に表示される
- [x] グラフが視覚的にわかりやすい
- [x] リアルタイムで更新される

---

### FR-008: チーム機能（Phase 2）

**優先度**: P2-Medium
**説明**: チームでタスクを共有・協働できる

**機能詳細**:
- チーム作成
- メンバー招待
- タスク割り当て
- チーム内通知

**受入基準**:
- [ ] チームを作成できる
- [ ] メンバーを招待できる
- [ ] タスクをメンバーに割り当てられる
- [ ] チーム内でタスクが共有される

---

## 🔒 非機能要件

### NFR-001: パフォーマンス

**目標**:
- ページロード時間: < 2秒（P95）
- API応答時間: < 500ms（P95）
- タスク一覧表示: 1000件まで < 1秒

**指標**:
- Lighthouse Performance Score: **90+**
- Core Web Vitals:
  - FCP: < 1.8s
  - LCP: < 2.5s
  - CLS: < 0.1

---

### NFR-002: セキュリティ

**要件**:
- HTTPS必須
- CC-Auth統合（OAuth 2.0）
- CSRF保護
- XSS対策
- SQL Injection対策（Prisma ORM使用）
- 定期的な依存関係脆弱性スキャン

**コンプライアンス**:
- GDPR準拠
- 個人情報保護法準拠

---

### NFR-003: アクセシビリティ

**要件**:
- WCAG 2.1 Level AA準拠
- キーボード操作対応
- スクリーンリーダー対応
- コントラスト比 4.5:1以上

**指標**:
- Lighthouse Accessibility Score: **100**

---

### NFR-004: 可用性

**目標**:
- 稼働率: 99.9%（月間ダウンタイム < 43分）
- 復旧時間目標（RTO）: < 1時間
- 復旧時点目標（RPO）: < 15分

**実装**:
- Multi-AZ構成（RDS）
- ALB + ECSでの高可用性
- 自動スケーリング

---

### NFR-005: スケーラビリティ

**目標**:
- 同時接続ユーザー: 1,000人
- タスク数: 100万件
- API リクエスト: 1,000 req/sec

**実装**:
- ECS Auto Scaling
- RDS Read Replica
- CloudFront CDN

---

## 🛠️ 技術制約（CCAGI SDK準拠）

### TC-001: 必須技術スタック

以下の技術スタックは**変更不可**です：

| 項目 | 指定バージョン | 根拠 |
|------|---------------|------|
| Node.js | 20.x (LTS) | CCAGI SDK標準 |
| TypeScript | 5.3+ | strict mode対応 |
| Next.js | 15.x | App Router必須 |
| Prisma | 6.0+ | pg adapter対応 |
| Docker Base | node:20-alpine | セキュリティ・サイズ最適化 |
| AWS SDK | v3.x | AWS SDK v3統一 |

### TC-002: 必須依存パッケージ

| パッケージ | 種別 | 用途 |
|-----------|------|------|
| `@customer-cloud/platform-sdk` | dependencies | 共通認証・決済基盤 |
| `@customer-cloud/ccagi-sdk` | devDependencies | CCAGI開発ツール |
| `@prisma/client` | dependencies | データベースORM |
| `@aws-sdk/client-sns` | dependencies | プッシュ通知 |
| `@aws-sdk/client-scheduler` | dependencies | 定期実行 |

### TC-003: データベース

| 項目 | 指定 |
|------|------|
| RDS | PostgreSQL 16.x |
| ORM | Prisma 6.0+ |
| マイグレーション | Prisma Migrate |
| 接続プール | @prisma/adapter-pg |

### TC-004: インフラストラクチャ

| 項目 | 指定 |
|------|------|
| コンテナ | Docker + ECR |
| オーケストレーション | ECS Fargate |
| ロードバランサー | ALB |
| CDN | CloudFront |
| DNS | Route 53 |
| CI/CD | CodePipeline + CodeBuild |

---

## 🌐 ドメイン・CC-Auth設定

### サブドメイン定義

| 環境 | サブドメイン | 用途 |
|------|-------------|------|
| 開発環境 | taskflow-dev.aidreams-factory.com | 開発・テスト |
| 本番環境 | taskflow.aidreams-factory.com | 本番サービス |
| ローカル | localhost:3000 | ローカル開発 |

### Route 53 情報

| 項目 | 値 |
|------|-----|
| AWSアカウントID | **607520774686** |
| Hosted Zone | aidreams-factory.com |
| Zone ID | Z0123456789ABCDEFGHIJ（要確認） |

### CC-Auth認証基盤連携

| 環境 | Account | User Pool ID | Client ID |
|------|---------|--------------|-----------|
| CC-Auth開発環境 | 805673386383 | ap-northeast-1_lSPtvbFS7 | 5nm9g294deq3r8dl8qkq33eohp |
| CC-Auth本番環境 | 661103479219 | ap-northeast-1_z76s7mTve | 6qpglrhtneplr9jvfcq4jpnr7r |

### CC-Auth URL登録（Phase 1で実施）

**ローカル開発環境（CC-Auth開発環境に登録）:**
- Callback: `http://localhost:3000/`, `http://localhost:3000/auth/callback`
- Logout: `http://localhost:3000/`, `http://localhost:3000/login`

**開発環境:**
- Callback: `https://taskflow-dev.aidreams-factory.com/`, `https://taskflow-dev.aidreams-factory.com/auth/callback`
- Logout: `https://taskflow-dev.aidreams-factory.com/`, `https://taskflow-dev.aidreams-factory.com/login`

**本番環境:**
- Callback: `https://taskflow.aidreams-factory.com/`, `https://taskflow.aidreams-factory.com/auth/callback`
- Logout: `https://taskflow.aidreams-factory.com/`, `https://taskflow.aidreams-factory.com/login`

### GitHub Package Registry 認証

プライベートパッケージのインストールには GitHub Token が必要：

| 環境 | Secret Name | AWS Account |
|------|-------------|-------------|
| Dev | `shared/github-npm-token` | 805673386383 |
| Prod | `shared/github-npm-token` | 661103479219 |

`.npmrc` 設定例:
```
//npm.pkg.github.com/:_authToken=${GITHUB_TOKEN}
@customer-cloud:registry=https://npm.pkg.github.com
```

---

## 💰 月額ランニングコスト見積もり

### 想定利用者数: **300名**

1ユーザーあたり1日20回のタスク操作（CRUD）を想定しています。

---

### 開発環境

**月額: 約45,000円**

| 項目 | 月額 | 内訳 |
|------|------|------|
| **インフラ費用** | **約35,000円** | |
| ECS Fargate | 15,000円 | 0.25 vCPU, 0.5GB RAM × 1タスク |
| RDS PostgreSQL | 12,000円 | db.t3.micro, 20GB SSD |
| ALB | 3,000円 | 基本料金 + データ転送 |
| CloudFront | 2,000円 | 10GB/月 |
| Route 53 | 1,000円 | Hosted Zone + クエリ |
| その他（S3, Secrets Manager） | 2,000円 | - |
| **AI/通知費用** | **約10,000円** | |
| Amazon SNS（通知） | 10,000円 | 300人 × 20日 × 3通知/日 |

---

### 本番環境

**月額: 約180,000円**

| 項目 | 月額 | 内訳 |
|------|------|------|
| **インフラ費用** | **約150,000円** | |
| ECS Fargate | 60,000円 | 0.5 vCPU, 1GB RAM × 3タスク（Multi-AZ） |
| RDS PostgreSQL | 50,000円 | db.t3.medium, 100GB SSD, Multi-AZ |
| ALB | 15,000円 | 高トラフィック対応 |
| CloudFront | 10,000円 | 100GB/月 |
| Route 53 | 2,000円 | - |
| EventBridge Scheduler | 3,000円 | 300人 × 3スケジュール |
| その他（S3, Secrets Manager, CloudWatch） | 10,000円 | - |
| **AI/通知費用** | **約30,000円** | |
| Amazon SNS（通知） | 30,000円 | 300人 × 20日 × 3通知/日 |

---

### 利用者数別の目安

| 利用者数 | 開発環境 | 本番環境 | 合計 |
|---------|---------|---------|------|
| 〜100名 | 30,000円 | 100,000円 | **130,000円** |
| 〜300名 | 45,000円 | 180,000円 | **225,000円** |
| 〜1,000名 | 70,000円 | 400,000円 | **470,000円** |
| 〜3,000名 | 120,000円 | 900,000円 | **1,020,000円** |

### コスト最適化のポイント

- **初期フェーズ**: 開発環境のみで月額30,000円から開始可能
- **スケーリング**: ECS Auto Scalingで需要に応じた自動調整
- **予約インスタンス**: RDS Reserved Instanceで30%コスト削減可能
- **通知最適化**: 通知頻度を調整することで通知コストを削減可能

---

## 📊 ユーザーストーリー

### US-001: タスク管理の基本

**As a** タスク管理ユーザー
**I want to** タスクを作成・編集・削除できる
**So that** 自分のタスクを効率的に管理できる

**シナリオ**:
1. ユーザーがログインする
2. 「新規タスク」ボタンをクリック
3. タイトル・詳細・締め切りを入力
4. 「作成」をクリック
5. タスク一覧に新しいタスクが表示される

---

### US-002: 締め切り通知

**As a** 忙しいビジネスパーソン
**I want to** タスクの締め切りが近づいたら通知を受け取る
**So that** 締め切りを見逃さない

**シナリオ**:
1. ユーザーがタスクを作成し、締め切りを設定
2. 締め切り1日前の09:00に通知が届く
3. 通知をクリックするとタスク詳細画面へ遷移
4. タスクを確認・完了する

---

### US-003: タスク検索

**As a** 大量のタスクを持つユーザー
**I want to** タスクを検索・フィルタリングできる
**So that** 必要なタスクをすぐに見つけられる

**シナリオ**:
1. ユーザーがタスク一覧を開く
2. 検索ボックスにキーワードを入力
3. リアルタイムで検索結果が絞り込まれる
4. 目的のタスクをクリックして詳細を表示

---

## ✅ 受入基準

### Phase 1（MVP）

- [x] ユーザー認証（CC-Auth統合）
- [x] タスクCRUD機能
- [x] 締め切り通知機能
- [x] ダッシュボード
- [x] レスポンシブデザイン
- [x] WCAG AA準拠

### Phase 2（拡張機能）

- [ ] チーム機能
- [ ] タスク共有
- [ ] メンバー招待
- [ ] コメント機能
- [ ] 変更履歴

---

## 📅 リリース計画

| マイルストーン | 期間 | 内容 |
|--------------|------|------|
| Phase 1: MVP | Week 1-4 | 基本機能実装 |
| Phase 2: 拡張 | Week 5-8 | チーム機能 |
| Phase 3: 最適化 | Week 9-10 | パフォーマンス改善 |
| Phase 4: 本番リリース | Week 11-12 | デプロイ・監視 |

---

## 🔗 関連ドキュメント

- [デザイン要件](./design-requirements.md) - UI/UX設計方針
- [技術仕様書](../design/spec.md) - Phase 2で生成
- [アーキテクチャ図](../design/architecture/) - Phase 2で生成

---

🤖 **Generated by CCAGI SDK v3.5.0**
📅 **作成日**: 2026-02-13
📝 **Phase**: 1 - Requirements
